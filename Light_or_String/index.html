<doctype html>
<!-- Copyright 2020, Cem Yuksel, University of Utah -->
<html>
<head>
<title>Light or Sting</title>


<!-- ── Full-screen ray-gen quad (env map) ------------------------------- -->
<script id="envRaytraceVS" type="x-shader/x-vertex">
attribute vec3 p;      // position in camera space plane
uniform   mat4 proj;   // projection matrix (P)
uniform   mat4 c2w;    // camera-to-world matrix ( = V^{-1} )
varying   vec3 ray_pos;// world ray origin
varying   vec3 ray_dir;// world ray direction
void main() {
    gl_Position = proj * vec4(p,1);       // draw the screen-plane triangle(s)
    vec4 rp = c2w * vec4(0,0,0,1);        // camera origin in world space
    ray_pos = rp.xyz;
    vec4 rd = c2w * vec4(p,1);            // a point on the camera plane in world
    ray_dir = rd.xyz - ray_pos;           // direction for this pixel
}
</script>

<script id="envFS" type="x-shader/x-fragment">
precision mediump float;
varying vec3 ray_dir;
uniform samplerCube envMap;
void main() {
    gl_FragColor = textureCube(envMap, ray_dir.xzy); // sample cubemap
}
</script>

<script id="glowVS" type="x-shader/x-vertex">
attribute vec3 p;        // vertex in the object's local space (often unit sphere)
uniform   mat4 mvp;      // P * V * M (projection * view * model)
uniform   vec3 center;   // world-space center of the glow volume
uniform   float scale;   // uniform radius scale for the mesh
varying   float d;       // passes a distance-like value to the fragment shader
void main() {
    vec3 pos = p * scale + center;      // MODEL: scale the local vertex and translate to world
    gl_Position = mvp * vec4(pos,1.0);  // to clip space (P*V*M)
    d = length(p) * scale;              // object-space radius at this vertex (≈ distance to center)
}
</script>

<script id="glowFS" type="x-shader/x-fragment">
precision mediump float;
varying float d;         // interpolated per pixel
uniform vec3  glowColor; // RGB of the glow
uniform float radius;    // falloff outer radius (in the same units as 'd')
uniform float gamma;     // inner-core factor (0..1), controls softness width
uniform float intensity; // overall opacity scale

void main() {
    float a = smoothstep(radius*gamma, radius, d);
    gl_FragColor = vec4(glowColor, (1.0 - a) * intensity);
}
</script>

<head>
  <link rel="stylesheet" href="styles.css">
</head>
</head>
<script src="utils.js"></script>
<script src="meshDrawer.js"></script>
<script src="obj.js"></script>
<script src="flyers.js"></script>
<script src="projectile.js"></script>
<script src="ray.js"></script>
<script src="sphere.js"></script>
<script src="init.js"></script>
<script src="main.js"></script>
<body onresize="WindowResize()">
<div id="canvas-div"><canvas id="canvas"></canvas><canvas id="overlay"></canvas></div><div id="controls-div">
<div id="score">Score: 0</div>
<div id="controls">
<div class="control-group">
<div class="control"><hr/></div>
<div class="control">
  <label for="firefly-input">Firefly Count:</label>
  <input type="number" id="firefly-input" min="0" max="20" value="3">
</div>
<div class="control">
  <label for="hornet-input">Hornet Count:</label>
  <input type="number" id="hornet-input" min="0" max="20" value="3">
</div>
<div class="control"><input type="button" class="btn" value="Start" onclick="NewScene()"></div>
</div>
</div>
</div>
</div>
</body>
</html>